Author -\/ Yatharth Bhasin

License\+: -- (this repo is private and unlicensed) 



Online {\itshape doxygen} documentation Link (auto-\/updated)\+: \href{https://yatharthb97.github.io/Correlator/index.html}{\tt https\+://yatharthb97.\+github.\+io/\+Correlator/index.\+html}

Plateform\+IO documentation\+: \href{https://docs.platformio.org/en/latest/}{\tt https\+://docs.\+platformio.\+org/en/latest/}

Local documentation can be generated in the {\ttfamily doc} subdirectory \+: {\ttfamily $>$$>$ doxygen Corr\+Doxyfile}

Doxygen documentation\+: \href{https://www.doxygen.nl/manual/index.html}{\tt https\+://www.\+doxygen.\+nl/manual/index.\+html} 



â†’ Photon Statistics Device\+: {\bfseries Multi-\/modal} device that is built with a framework of $\ast$$\ast$\char`\"{}feature lines\char`\"{}$\ast$$\ast$, that individually contain a set of features that can be used simultaneously. The features can be be selected with the option {\ttfamily \char`\"{}\+Feature Line\char`\"{}} in the {\ttfamily config.\+json} file. Set of valid feature lines include\+:


\begin{DoxyEnumerate}
\item {\ttfamily \char`\"{}\+A\+C\+F\char`\"{}} -\/ Autocorrelation function and related calculations
\item {\ttfamily \char`\"{}\+Interarrival\char`\"{}} -\/ Interarrival statistics
\item {\ttfamily \char`\"{}\+Sampler\char`\"{}} -\/ Samples the counter value at periodic intervals and maintains a running mean of the counter values.
\end{DoxyEnumerate}

\subsubsection*{Usage}


\begin{DoxyEnumerate}
\item Select the correct options and set the required values in {\ttfamily config.\+json} file.
\item Compile and push code to the device after saving the {\ttfamily config.\+json} file.
\item Run the PC side software (instructions below). 


\end{DoxyEnumerate}
\begin{DoxyItemize}
\item The board (microcontroller) settings are present in the file {\ttfamily plateformio.\+ini}. This file can be generated by using {\ttfamily Plateform\+IO}.
\item The module settings are present in the file {\ttfamily config.\+json}. This file is autogenerated if it is absent in the root directory. Missing fields are also added to the file during compile time with default values, and a warning message is generated.
\end{DoxyItemize}

\subsubsection*{\hyperlink{classErrors}{Errors} and Debugging options ==Incomplete==}

\subsubsection*{Emulation and Testing}


\begin{DoxyItemize}
\item The software modules can be tested/simulated on a PC. The files {\ttfamily \hyperlink{test_8cpp}{test.\+cpp}}, {\ttfamily \hyperlink{pseudoSerial_8hpp}{pseudo\+Serial.\+hpp}}, and {\ttfamily \hyperlink{pseudoSerial_8cpp}{pseudo\+Serial.\+cpp}} in the subdirectory {\ttfamily ./code/software/} provide functionality to do so. The macro {\ttfamily C\+O\+R\+R\+\_\+\+S\+I\+M\+U\+L\+A\+T\+I\+ON} must be set during compilation to enable the contents of this file.
\item The file {\ttfamily \hyperlink{test_8cpp}{test.\+cpp}} contain module by module tests for the software modules. {\ttfamily \hyperlink{pseudoSerial_8hpp}{pseudo\+Serial.\+hpp}}, and {\ttfamily \hyperlink{pseudoSerial_8cpp}{pseudo\+Serial.\+cpp}} emulate the serial port on the device.

Compile\+:
\end{DoxyItemize}


\begin{DoxyCode}
g++ test.cpp pseudoSerial.cpp -D CORR\_SIMULATION
\end{DoxyCode}



\begin{DoxyItemize}
\item The subdirectory {\ttfamily ./full\+\_\+emulator}/ includes a complete emulator for the multitau module that operates with the python G\+UI. ==Incomplete==
\begin{DoxyItemize}
\item The module can be fed data from a saved file or the counter values can be randomly generated.
\end{DoxyItemize}
\end{DoxyItemize}

\subsection*{Feature Lines (Device Modes)}

Feature Lines are specific {\itshape modes} for the device. This is a framework that arranges all the different features and tests in a neat and accessible manner.

\subsubsection*{Common Features}


\begin{DoxyItemize}
\item {\ttfamily \char`\"{}\+Enable Sync Code\char`\"{}} -\/ A specific synchronization code (set by {\ttfamily \char`\"{}\+Sync Code\char`\"{}} option) is added to the start of each struct that is transmitted from the device. At the receiver end, the software verifies this code and generates and error message if the code is not correct. The error means that the struct is misaligned and the data that is received cannot be used.

One way to emulate this error is to change the {\ttfamily config.\+json} file and start the PC software without compiling and pushing the changed configuration to the device.
\end{DoxyItemize}

\subsubsection*{Feature Line 1 -\/ {\ttfamily A\+CF} (Gate Counting)}

This is the main feature line. This mode supports the following features which can be selectively be enabled from the configuration file. The features have zero-\/footprint on performance when disabled, similarly, each feature adds an overhead to the performance of the device.

{\itshape Device ready} state is indicated by the {\itshape R\+ED L\+ED} and {\itshape Device running} state is indicated by the {\itshape G\+R\+E\+EN L\+ED} on the Panel.


\begin{DoxyItemize}
\item {\ttfamily \char`\"{}\+Enable A\+C\+F\char`\"{}} \+: Enable Auto-\/correlation calculation
\item {\ttfamily \char`\"{}\+Enable Count Rate\char`\"{}} -\/ Enable Count Rate Calculation
\item {\ttfamily \char`\"{}\+Enable P\+C Histogram\char`\"{}} -\/ Enable Photon Counting Histogram
\item {\ttfamily \char`\"{}\+Enable Performance Counters\char`\"{}} -\/ Enable Performance Counters for Serial Output and A\+CF calculation. This counts the number of clock cycles for the particular operations and maintains a mean value. 


\item {\ttfamily \char`\"{}\+Enable Points Norm\char`\"{}} -\/ Enable simple points normalization (under review).
\item {\ttfamily \char`\"{}\+Enable Mean Norm\char`\"{}} -\/ Enable normalization based on mean count rate. (under review)
\end{DoxyItemize}

\subsubsection*{Feature Line 2 -\/ {\ttfamily Interarrival} (Tight Polling)}

{\itshape Device ready} state is indicated by the {\itshape B\+L\+UE L\+ED} and {\itshape Device running} state is indicated by the {\itshape W\+H\+I\+TE L\+ED} on the Panel.

==Implementation Pending==

\subsubsection*{Feature Line 3 -\/ {\ttfamily Sampler} (Gate Counting)}

{\itshape Device ready} state is indicated by the {\itshape W\+H\+I\+TE L\+ED} and {\itshape Device running} state is indicated by the {\itshape G\+R\+E\+EN L\+ED} on the Panel.

This feature samples the Counter value at periodic intervals (set by {\ttfamily \char`\"{}\+Sampling Delay ms\char`\"{}}) and prints the counter value, mean counter value, etc with line separation. Hence, the {\ttfamily \char`\"{}\+Enable Synchronization Code\char`\"{}} is ignored, since the synchronization is performed via the endline characters {\ttfamily \textbackslash{}r\textbackslash{}n}.

Typical output\+: cv\+: counter value (sampled), m\+: mean, c\+: count of read values, a\+: accumulate


\begin{DoxyCode}
cv: 10  m: 0.10  c: 2667270000  a: 268435456.00
\end{DoxyCode}


\subsection*{Module Description ({\ttfamily Incomplete})}

\subsubsection*{Pure Software Modules}

This folder contains the implementation of the software correlator that will be used on Teensy. The file descriptions are as follows\+:


\begin{DoxyItemize}
\item {\ttfamily Lin\+\_\+\+A\+Corr\+\_\+\+R\+T\+\_\+\+Base.\+hpp} -\/ Base (Interface) for Linear Correlators
\item {\ttfamily \hyperlink{Lin__ACorr__RT__Teensy_8hpp}{Lin\+\_\+\+A\+Corr\+\_\+\+R\+T\+\_\+\+Teensy.\+hpp}} -\/ Implementation specific to Teensy
\item {\ttfamily \hyperlink{multi__tau_8hpp}{multi\+\_\+tau.\+hpp}} -\/ Teensy specific implementation of multi-\/tau Auto-\/correlator
\item {\ttfamily \hyperlink{accumulator_8hpp}{accumulator.\+hpp}} -\/ Adapter object used by Multi Tau A\+Corr
\item {\ttfamily \hyperlink{discarder_8hpp}{discarder.\+hpp}} -\/ Adapter object used by Multi Tau A\+Corr
\item {\ttfamily \hyperlink{simpler__circular__buffer_8hpp}{simpler\+\_\+circular\+\_\+buffer.\+hpp}} -\/ Simple circlar buffer used for storing the cout values.
\item {\ttfamily \hyperlink{types_8hpp}{types.\+hpp}} -\/ Contains the {\ttfamily typedef} of the abstracted typenames
\begin{DoxyItemize}
\item {\ttfamily counter\+\_\+t} -\/ Type returned by the Counter module
\item {\ttfamily index\+\_\+t} -\/ Type used to index arrays and buffers in the implementation
\end{DoxyItemize}
\item {\ttfamily \hyperlink{test_8cpp}{test.\+cpp}} -\/ File used for tsting
\item {\ttfamily circlar\+\_\+buffer.\+hpp} -\/ Another implementation of circular buffer (unsued right now)
\item {\ttfamily Lin\+\_\+\+Cross\+Corr\+\_\+\+R\+T\+\_\+\+Base.\+hpp} -\/ Base interface for Linear Cross Correlators
\item {\ttfamily \hyperlink{Lin__CrossCorr__RT__Teensy_8hpp}{Lin\+\_\+\+Cross\+Corr\+\_\+\+R\+T\+\_\+\+Teensy.\+hpp}} -\/ Teensy specific Liner Cross Correlator interface
\end{DoxyItemize}

\subsubsection*{Hardware Modules (are specific to Teensy 4.\+1)}

File descriptions\+:


\begin{DoxyItemize}
\item {\ttfamily \hyperlink{pit_8hpp}{pit.\+hpp}} -\/ Defines {\ttfamily class \hyperlink{classPITController}{P\+I\+T\+Controller}} that provides an abstraction layer on the P\+IT timer controls.
\item {\ttfamily \hyperlink{qtmr1_8hpp}{qtmr1.\+hpp}} -\/ Defines \textquotesingle{}class Q\+T\+M\+R1\+Controller\textquotesingle{} that provides an abstraction layer on the Q\+T\+M\+R1 timer controls.
\item {\ttfamily \hyperlink{lifetime__timer_8hpp}{lifetime\+\_\+timer.\+hpp}} -\/ Interface for using P\+IT timers in chained mode to create a 64-\/bit lifetime counter
\end{DoxyItemize}

\subsubsection*{Common Interface}


\begin{DoxyItemize}
\item {\ttfamily modules.\+hpp} -\/ Defines functions that represent highest-\/abstracted modules in the system.
\item {\ttfamily \hyperlink{errors_8hpp}{errors.\+hpp}} -\/ Defines common error codes and error generating functions.
\item {\ttfamily \hyperlink{utilities_8hpp}{utilities.\+hpp}} -\/ Contains some utility functions
\end{DoxyItemize}

\subsubsection*{PC Application}

This portion is written in python 3.

The PC application can be launched \+: {\ttfamily $>$$>$ python ./code/pc\+\_\+app/photon\+\_\+statistics.py} 